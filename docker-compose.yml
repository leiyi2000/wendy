version: '3.8'
services:
  wendy-apiserver:
    build:
      context: .
      dockerfile: Dockerfile
    image: wendy-apiserver:${IMAGE_TAG:-latest}
    volumes:
      - data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DOCKER_VOLUME=${DOCKER_VOLUME:-wendy_data}
      - DEPLOYMENT_PATH=${DOCKER_VOLUME:-/app/data}
      - DATABASE_URL=${DATABASE_URL:-sqlite://data/wendy.sqlite3}
      - DOCKERFILE_PATH=${DOCKERFILE_PATH:-/app/template/Dockerfile.tar.xz}
    ports:
      - "8000:8000"
    restart: always

volumes:
  data: